<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[[转]Git的内部实现原理浅谈]]></title>
      <url>http://yoursite.com/2016/08/31/%E8%BD%AC-Git%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88/</url>
      <content type="html"><![CDATA[<p>快速的版本回退、分支切换，一直是Git作为分布式版本管理系统为人所津津乐道，而这些优秀的属性自然离不开其内部的实现原理，因此参考了下<a href="https://git-scm.com/book/zh/v2" target="_blank" rel="external">《Pro Git》</a>来看看这个优秀的版本控制系统在内部是如何工作的。</p>
<h2 id="Git对象"><a href="#Git对象" class="headerlink" title="Git对象"></a>Git对象</h2><p>Git是一个内容寻址（content-addressable）文件系统，有点像java中的键值对（key-value），它的核心部分是一个简单的键值对数据库。我们先初始化一个新的Git版本库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git init <span class="built_in">test</span></div><div class="line">$ <span class="built_in">cd</span> <span class="built_in">test</span></div><div class="line">$ find .git/objects</div><div class="line">$ find .git/objects -type f</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><img src="https://raw.githubusercontent.com/XianboChen/MyBlog/master/picture/git1.png" alt=""><br>可以看到Git对objects目录进行了初始化，并创建了pack和info子目录，但均为空。<br>注：-type f指正规文件<br>接着往Git数据库中存入一些文本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ echo &apos;test content&apos; | git hash-object -w --stdin</div><div class="line">d670460b4b4aece5915caf5c68d12f560a9fe3e4</div></pre></td></tr></table></figure></p>
<p>-w 选项指示hash-object命令存储数据对象；若不指定此选项，则该命令仅返回对应的键值。–stdin选项则指示该命令从标准输入读取内容；若不指定此选项，则须在命令尾部给出待存储文件的路径。该命令输出一个长度为40个字符的校验和。这是一个SHA-1哈希值——一个将待存储的数据外加一个头部信息（header）一起做SHA-1校验运算而得的校验和。<br>此时再次运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ find .git/objects -type f</div><div class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</div></pre></td></tr></table></figure></p>
<p>可以在objects目录下看到一个文件。这就是开始时 Git 存储内容的方式——一个文件对应一条内容，以该内容加上特定头部信息一起的SHA-1校验和为文件命名。校验和的前两个字符用于命名子目录，余下的38个字符则用作文件名。<br>可以通过cat-file命令从Git那里取回数据。为cat-file指定-p选项可指示该命令自动判断内容的类型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git cat-file -p d670460b4b4aece5915caf5c68d12f560a9fe3e4</div><div class="line">test content</div></pre></td></tr></table></figure></p>
<p>至此，你已经掌握了如何向 Git 中存入内容，以及如何将它们取出。 我们同样可以将这些操作应用于文件中的内容。 例如，可以对一个文件进行简单的版本控制。 首先，创建一个新文件并将其内容存入数据库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ echo &apos;version 1&apos; &gt; test.txt</div><div class="line">$ git hash-object -w test.txt</div><div class="line">83baae61804e65cc73a7201a7252750c76066a30</div></pre></td></tr></table></figure></p>
<p>接着，向文件里写入新内容，并再次将其存入数据库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ echo &apos;version 2&apos; &gt; test.txt</div><div class="line">$ git hash-object -w test.txt</div><div class="line">1f7a7a472abf3dd9643fd615f6da379c4acb3e3a</div></pre></td></tr></table></figure></p>
<p>数据库记录下了该文件的两个不同版本，当然之前我们存入的第一条内容也还在：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ find .git/objects -type f</div><div class="line">.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a</div><div class="line">.git/objects/83/baae61804e65cc73a7201a7252750c76066a30</div><div class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</div></pre></td></tr></table></figure></p>
<p>现在可以把文件内容恢复到第一个版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git cat-file -p 83baae61804e65cc73a7201a7252750c76066a30 &gt; test.txt</div><div class="line">$ cat test.txt</div><div class="line">version 1</div></pre></td></tr></table></figure></p>
<p>或者第二个版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git cat-file -p 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a &gt; test.txt</div><div class="line">$ cat test.txt</div><div class="line">version 2</div></pre></td></tr></table></figure></p>
<p>然而，记住文件的每一个版本所对应的 SHA-1 值并不现实；另一个问题是，在这个（简单的版本控制）系统中，文件名并没有被保存——我们仅保存了文件的内容。 上述类型的对象我们称之为数据对象（blob object）。 利用 cat-file -t 命令，可以让 Git 告诉我们其内部存储的任何对象类型，只要给定该对象的 SHA-1 值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git cat-file -t 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a</div><div class="line">blob</div></pre></td></tr></table></figure></p>
<h2 id="树对象"><a href="#树对象" class="headerlink" title="树对象"></a>树对象</h2><p>接下来要探讨的对象类型是树对象（tree object），它能解决文件名保存的问题，也允许我们将多个文件组织到一起。 Git 以一种类似于 UNIX 文件系统的方式存储内容，但作了些许简化。 所有内容均以树对象和数据对象的形式存储，其中树对象对应了 UNIX 中的目录项，数据对象则大致上对应了 inodes 或文件内容。 一个树对象包含了一条或多条树对象记录（tree entry），每条记录含有一个指向数据对象或者子树对象的 SHA-1 指针，以及相应的模式、类型、文件名信息。 例如，某项目当前对应的最新树对象可能是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git cat-file -p master^&#123;tree&#125;</div><div class="line">100644 blob a906cb2a4a904a152e80877d4088654daad0c859      README</div><div class="line">100644 blob 8f94139338f9404f26296befa88755fc2598c289      Rakefile</div><div class="line">040000 tree 99f1a6d12cb4b6f19c8655fca46c3ecf317074e0      lib</div></pre></td></tr></table></figure></p>
<p>master^{tree} 语法表示 master 分支上最新的提交所指向的树对象。 请注意，lib 子目录（所对应的那条树对象记录）并不是一个数据对象，而是一个指针，其指向的是另一个树对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git cat-file -p 99f1a6d12cb4b6f19c8655fca46c3ecf317074e0</div><div class="line">100644 blob 47c6340d6459e05787f644c2447d2595f5d3a54b      simplegit.rb</div></pre></td></tr></table></figure></p>
<p>从概念上讲，Git 内部存储的数据有点像这样：<br><img src="https://git-scm.com/book/en/v2/book/10-git-internals/images/data-model-1.png" alt="Figure 10-1. 简化版的 Git 数据模型。"><br>你可以轻松创建自己的树对象。 通常，Git 根据某一时刻暂存区（即 index 区域，下同）所表示的状态创建并记录一个对应的树对象，如此重复便可依次记录（某个时间段内）一系列的树对象。 因此，为创建一个树对象，首先需要通过暂存一些文件来创建一个暂存区。 可以通过底层命令 update-index 为一个单独文件——我们的 test.txt 文件的首个版本——创建一个暂存区。 利用该命令，可以把 test.txt 文件的首个版本人为地加入一个新的暂存区。 必须为上述命令指定 –add 选项，因为此前该文件并不在暂存区中（我们甚至都还没来得及创建一个暂存区呢）；同样必需的还有 –cacheinfo 选项，因为将要添加的文件位于 Git 数据库中，而不是位于当前目录下。 同时，需要指定文件模式、SHA-1 与文件名：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git update-index --add --cacheinfo 100644 \</div><div class="line">  83baae61804e65cc73a7201a7252750c76066a30 test.txt</div></pre></td></tr></table></figure></p>
<p>本例中，我们指定的文件模式为 100644，表明这是一个普通文件。 其他选择包括：100755，表示一个可执行文件；120000，表示一个符号链接。 这里的文件模式参考了常见的 UNIX 文件模式，但远没那么灵活——上述三种模式即是 Git 文件（即数据对象）的所有合法模式（当然，还有其他一些模式，但用于目录项和子模块）。</p>
<p>现在，可以通过 write-tree 命令将暂存区内容写入一个树对象。 此处无需指定 -w 选项——如果某个树对象此前并不存在的话，当调用 write-tree 命令时，它会根据当前暂存区状态自动创建一个新的树对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git write-tree</div><div class="line">d8329fc1cc938780ffdd9f94e0d364e0ea74f579</div><div class="line">$ git cat-file -p d8329fc1cc938780ffdd9f94e0d364e0ea74f579</div><div class="line">100644 blob 83baae61804e65cc73a7201a7252750c76066a30      test.txt</div></pre></td></tr></table></figure></p>
<p>不妨验证一下它确实是一个树对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git cat-file -t d8329fc1cc938780ffdd9f94e0d364e0ea74f579</div><div class="line">tree</div></pre></td></tr></table></figure></p>
<p>接着我们来创建一个新的树对象，它包括 test.txt 文件的第二个版本，以及一个新的文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ echo &apos;new file&apos; &gt; new.txt</div><div class="line">$ git update-index test.txt</div><div class="line">$ git update-index --add new.txt</div></pre></td></tr></table></figure></p>
<p>暂存区现在包含了 test.txt 文件的新版本，和一个新文件：new.txt。 记录下这个目录树（将当前暂存区的状态记录为一个树对象），然后观察它的结构：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ git write-tree</div><div class="line">0155eb4229851634a0f03eb265b69f5a2d56f341</div><div class="line">$ git cat-file -p 0155eb4229851634a0f03eb265b69f5a2d56f341</div><div class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</div><div class="line">100644 blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a      test.txt</div></pre></td></tr></table></figure></p>
<p>我们注意到，新的树对象包含两条文件记录，同时 test.txt 的 SHA-1 值（1f7a7a）是先前值的“第二版”。 只是为了好玩：你可以将第一个树对象加入第二个树对象，使其成为新的树对象的一个子目录。 通过调用 read-tree 命令，可以把树对象读入暂存区。 本例中，可以通过对 read-tree 指定 –prefix 选项，将一个已有的树对象作为子树读入暂存区：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ git read-tree --prefix=bak d8329fc1cc938780ffdd9f94e0d364e0ea74f579</div><div class="line">$ git write-tree</div><div class="line">3c4e9cd789d88d8d89c1073707c3585e41b0e614</div><div class="line">$ git cat-file -p 3c4e9cd789d88d8d89c1073707c3585e41b0e614</div><div class="line">040000 tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579      bak</div><div class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</div><div class="line">100644 blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a      test.txt</div></pre></td></tr></table></figure></p>
<p>如果基于这个新的树对象创建一个工作目录，你会发现工作目录的根目录包含两个文件以及一个名为 bak 的子目录，该子目录包含 test.txt 文件的第一个版本。 可以认为 Git 内部存储着的用于表示上述结构的数据是这样的：<br><img src="https://git-scm.com/book/en/v2/book/10-git-internals/images/data-model-2.png" alt=""></p>
<h2 id="提交对象"><a href="#提交对象" class="headerlink" title="提交对象"></a>提交对象</h2><p>现在有三个树对象，分别代表了我们想要跟踪的不同项目快照。然而问题依旧：若想重用这些快照，你必须记住所有三个 SHA-1 哈希值。 并且，你也完全不知道是谁保存了这些快照，在什么时刻保存的，以及为什么保存这些快照。 而以上这些，正是提交对象（commit object）能为你保存的基本信息。</p>
<p>可以通过调用 commit-tree 命令创建一个提交对象，为此需要指定一个树对象的 SHA-1 值，以及该提交的父提交对象（如果有的话）。 我们从之前创建的第一个树对象开始：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ echo &apos;first commit&apos; | git commit-tree d8329f</div><div class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d</div></pre></td></tr></table></figure></p>
<p>现在可以通过 cat-file 命令查看这个新提交对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ git cat-file -p fdf4fc3</div><div class="line">tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579</div><div class="line">author Scott Chacon &lt;schacon@gmail.com&gt; 1243040974 -0700</div><div class="line">committer Scott Chacon &lt;schacon@gmail.com&gt; 1243040974 -0700</div><div class="line">first commit</div></pre></td></tr></table></figure></p>
<p>提交对象的格式很简单：它先指定一个顶层树对象，代表当前项目快照；然后是作者/提交者信息（依据你的 user.name 和 user.email 配置来设定，外加一个时间戳）；留空一行，最后是提交注释。</p>
<p>接着，我们将创建另两个提交对象，它们分别引用各自的上一个提交（作为其父提交对象）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ echo &apos;second commit&apos; | git commit-tree 0155eb -p fdf4fc3</div><div class="line">cac0cab538b970a37ea1e769cbbde608743bc96d</div><div class="line">$ echo &apos;third commit&apos;  | git commit-tree 3c4e9c -p cac0cab</div><div class="line">1a410efbd13591db07496601ebc7a059dd55cfe9</div></pre></td></tr></table></figure></p>
<p>这三个提交对象分别指向之前创建的三个树对象快照中的一个。 现在，如果对最后一个提交的 SHA-1 值运行 git log 命令，会出乎意料的发现，你已有一个货真价实的、可由 git log 查看的 Git 提交历史了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">$ git log --stat 1a410e</div><div class="line">commit 1a410efbd13591db07496601ebc7a059dd55cfe9</div><div class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</div><div class="line">Date:   Fri May 22 18:15:24 2009 -0700</div><div class="line"></div><div class="line">	third commit</div><div class="line"></div><div class="line"> bak/test.txt | 1 +</div><div class="line"> 1 file changed, 1 insertion(+)</div><div class="line"></div><div class="line">commit cac0cab538b970a37ea1e769cbbde608743bc96d</div><div class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</div><div class="line">Date:   Fri May 22 18:14:29 2009 -0700</div><div class="line"></div><div class="line">	second commit</div><div class="line"></div><div class="line"> new.txt  | 1 +</div><div class="line"> test.txt | 2 +-</div><div class="line"> 2 files changed, 2 insertions(+), 1 deletion(-)</div><div class="line"></div><div class="line">commit fdf4fc3344e67ab068f836878b6c4951e3b15f3d</div><div class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</div><div class="line">Date:   Fri May 22 18:09:34 2009 -0700</div><div class="line"></div><div class="line">    first commit</div><div class="line"></div><div class="line"></div><div class="line"> test.txt | 1 +</div><div class="line"> 1 file changed, 1 insertion(+)</div></pre></td></tr></table></figure></p>
<p> <img src="https://raw.githubusercontent.com/XianboChen/MyBlog/master/picture/git2.png" alt=""><br> 注：这里的hash值与文中的不同，应该是由于Author的不同所致</p>
<p>太神奇了： 就在刚才，你没有借助任何上层命令，仅凭几个底层操作便完成了一个 Git 提交历史的创建。 这就是每次我们运行 git add 和 git commit 命令时， Git 所做的实质工作——将被改写的文件保存为数据对象，更新暂存区，记录树对象，最后创建一个指明了顶层树对象和父提交的提交对象。 这三种主要的 Git 对象——数据对象、树对象、提交对象——最初均以单独文件的形式保存在 .git/objects 目录下。 下面列出了目前示例目录内的所有对象，辅以各自所保存内容的注释：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ find .git/objects -type f</div><div class="line">.git/objects/01/55eb4229851634a0f03eb265b69f5a2d56f341 # tree 2</div><div class="line">.git/objects/1a/410efbd13591db07496601ebc7a059dd55cfe9 # commit 3</div><div class="line">.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a # test.txt v2</div><div class="line">.git/objects/3c/4e9cd789d88d8d89c1073707c3585e41b0e614 # tree 3</div><div class="line">.git/objects/83/baae61804e65cc73a7201a7252750c76066a30 # test.txt v1</div><div class="line">.git/objects/ca/c0cab538b970a37ea1e769cbbde608743bc96d # commit 2</div><div class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4 # &apos;test content&apos;</div><div class="line">.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579 # tree 1</div><div class="line">.git/objects/fa/49b077972391ad58037050f2a75f74e3671e92 # new.txt</div><div class="line">.git/objects/fd/f4fc3344e67ab068f836878b6c4951e3b15f3d # commit 1</div></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/XianboChen/MyBlog/master/picture/git3.png" alt=""><br>如果跟踪所有的内部指针，将得到一个类似下面的对象关系图：<br><img src="https://git-scm.com/book/en/v2/book/10-git-internals/images/data-model-3.png" alt=""></p>
<p>以上内容节选自<a href="https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-Git-%E5%AF%B9%E8%B1%A1" target="_blank" rel="external">Pro Git 10.2 Git 内部原理 - Git 对象。</a><br>文中使用了很多git底层命令，参见:<a href="https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-%E5%BA%95%E5%B1%82%E5%91%BD%E4%BB%A4%E5%92%8C%E9%AB%98%E5%B1%82%E5%91%BD%E4%BB%A4" target="_blank" rel="external">10.1 Git 内部原理 - 底层命令和高层命令。</a><br>英文版参见：<a href="https://git-scm.com/book/en/v2/Git-Internals-Git-Objects" target="_blank" rel="external">10.2 Git Internals - Git Objects</a><br><a href="https://git-scm.com/book/en/v2/Git-Internals-Plumbing-and-Porcelain" target="_blank" rel="external">10.1 Git Internals - Plumbing and Porcelain</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[[转]Android编译系统的理解]]></title>
      <url>http://yoursite.com/2016/08/20/%E8%BD%AC-Android%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%90%86%E8%A7%A3/</url>
      <content type="html"><![CDATA[<p>Android编译系统庞大，想要理解还是要花点功夫的，今天看到篇不错的帖子，特此转载。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Android Build 系统是用来编译 Android 系统，Android SDK 以及相关文档的一套框架。众所周知，Android 是一个开源的操作系统。Android 的源码中包含了许许多多的模块。 不同产商的不同设备对于 Android 系统的定制都是不一样的。如何将这些模块统一管理起来，如何能够在不同的操作系统上进行编译，如何在编译时能够支持面向不同的硬件设备，不同的编译类型，且还要提供面向各个产商的定制扩展，是非常有难度的。 但 Android Build 系统很好的解决了这些问题，这里面有很多值得我们开发人员学习的地方。对于 Android 平台开发人员来说，本文可以帮助你熟悉你每天接触到的构建环境。对于其他开发人员来说，本文可以作为一个 GNU Make的使用案例，学习这些成功案例，可以提升我们的开发经验。</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>Build 系统中最主要的处理逻辑都在 Make 文件中，而其他的脚本文件只是起到一些辅助作用，由于篇幅所限，本文只探讨 Make 文件中的内容。<br>    整个 Build 系统中的 Make 文件可以分为三类：<br>    第一类是 Build 系统核心文件<br>    此类文件定义了整个 Build 系统的框架，而其他所有 Make 文件都是在这个框架的基础上编写出来的。</p>
<p>图 1 是 Android 源码树的目录结构，Build 系统核心文件全部位于 /build/core（本文所提到的所有路径都是以 Android 源码树作为背景的，“/”指的是源码树的根目录，与文件系统无关）目录下。</p>
<p><img src="www.ibm.com/developerworks/cn/opensource/os-cn-android-build/image001.png" alt=""></p>
<p>第二类是针对某个产品（一个产品可能是某个型号的手机或者平板电脑）的 Make 文件<br>这些文件通常位于 device 目录下，该目录下又以公司名以及产品名分为两级目录，图 2 是 device 目录下子目录的结构。对于一个产品的定义通常需要一组文件，这些文件共同构成了对于这个产品的定义。例如，/device/sony/it26 目录下的文件共同构成了对于 Sony LT26 型号手机的定义<br><img src="http://www.ibm.com/developerworks/cn/opensource/os-cn-android-build/image002.png" alt=""><br>第三类是针对某个模块（关于模块后文会详细讨论）的 Make 文件<br> 整个系统中，包含了大量的模块，每个模块都有一个专门的 Make 文件，这类文件的名称统一为“Android.mk”，该文件中定义了如何编译当前模块。Build 系统会在整个源码树中扫描名称为“Android.mk”的文件并根据其中的内容执行模块的编译。</p>
<h3 id="编译Android系统"><a href="#编译Android系统" class="headerlink" title="编译Android系统"></a>编译Android系统</h3><h4 id="执行编译"><a href="#执行编译" class="headerlink" title="执行编译"></a>执行编译</h4><p>   Android 系统的编译环境目前只支持 Ubuntu 以及 Mac OS 两种操作系统。关于编译环境的构建方法请参见以下路径：<a href="http://source.android.com/source/initializing.html" target="_blank" rel="external">http://source.android.com/source/initializing.html</a><br>在完成编译环境的准备工作以及获取到完整的 Android 源码之后，想要编译出整个 Android 系统非常的容易：<br>打开控制台之后转到 Android 源码的根目录，然后执行如清单 1</p>
<p>所示的三条命令即可（”$”是命令提示符，不是命令的一部分。）：</p>
<p>完整的编译时间依赖于编译主机的配置，在笔者的 Macbook Pro（OS X 10.8.2, i7 2G CPU，8G RAM, 120G SSD）上使用 8 个 Job 同时编译共需要一个半小时左右的时间。<br>清单一：编译Android系统<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ source build/envsetup.sh </div><div class="line">$ lunch full-eng </div><div class="line">$ make -j8</div></pre></td></tr></table></figure></p>
<p>这三行命令的说明如下：</p>
<p>第一行命令“source build/envsetup.sh”引入了 build/envsetup.sh脚本。该脚本的作用是初始化编译环境，并引入一些辅助的 Shell 函数，这其中就包括第二步使用 lunch 函数。</p>
<p>除此之外，该文件中还定义了其他一些常用的函数，它们如表 1 所示：<br>表一：build/envsetup.sh中定义的常用函数<br>| 名称        | 说明         |<br>| ————- |————-|<br>|croot |    切换到源码树的根目录|<br>|m|     在源码树的根目录执行 make|<br>|mm     |Build 当前目录下的模块|<br>|mmm |    Build 指定目录下的模块|<br>|cgrep |    在所有 C/C++ 文件上执行 grep|<br>|jgrep |    在所有 Java 文件上执行 grep|<br>|resgrep |    在所有 res/*.xml 文件上执行 grep|<br>|godir     |转到包含某个文件的目录路径|<br>|printconfig|     显示当前 Build 的配置信息|<br>|add_lunch_combo |    在 lunch 函数的菜单中添加一个条目|</p>
<p>第二行命令“lunch full-eng”是调用 lunch 函数，并指定参数为“full-eng”。lunch 函数的参数用来指定此次编译的目标设备以及编译类型。在这里，这两个值分别是“full”和“eng”。“full”是 Android 源码中已经定义好的一种产品，是为模拟器而设置的。而编译类型会影响最终系统中包含的模块，关于编译类型将在表 7 中详细讲解。</p>
<p>如果调用 lunch 函数的时候没有指定参数，那么该函数将输出列表以供选择，该列表类似图 3 中的内容（列表的内容会根据当前 Build 系统中包含的产品配置而不同，具体参见后文“添加新的产品”），此时可以通过输入编号或者名称进行选择。<br>图三，lunch函数的输出<br><img src="http://www.ibm.com/developerworks/cn/opensource/os-cn-android-build/image003.png" alt=""><br>图 3. lunch 函数的输出<br>    第三行命令“make -j8”才真正开始执行编译。make 的参数“-j”指定了同时编译的 Job 数量，这是个整数，该值通常是编译主机 CPU 支持的并发线程总数的 1 倍或 2 倍（例如：在一个 4 核，每个核支持两个线程的 CPU 上，可以使用 make -j8 或 make -j16）。在调用 make 命令时，如果没有指定任何目标，则将使用默认的名称为“droid”目标，该目标会编译出完整的 Android 系统镜像。</p>
<h3 id="Build结果的目录结构"><a href="#Build结果的目录结构" class="headerlink" title="Build结果的目录结构"></a>Build结果的目录结构</h3><p>所有的编译产物都将位于 /out 目录下，该目录下主要有以下几个子目录：<br>    /out/host/：该目录下包含了针对主机的 Android 开发工具的产物。即 SDK 中的各种工具，例如：emulator，adb，aapt 等。<br>    /out/target/common/：该目录下包含了针对设备的共通的编译产物，主要是 Java 应用代码和 Java 库。<br>    /out/target/product/<product_name>/：包含了针对特定设备的编译结果以及平台相关的 C/C++ 库和二进制文件。其中，<product_name>是具体目标设备的名称。<br>    /out/dist/：包含了为多种分发而准备的包，通过“make disttarget”将文件拷贝到该目录，默认的编译目标不会产生该目录。</product_name></product_name></p>
<p>Build生成的镜像文件：</p>
<p>Build 的产物中最重要的是三个镜像文件，它们都位于 /out/target/product/<product_name>/ 目录下。</product_name></p>
<p>这三个文件是：<br>    system.img：包含了 Android OS 的系统文件，库，可执行文件以及预置的应用程序，将被挂载为根分区。<br>    ramdisk.img：在启动时将被 Linux 内核挂载为只读分区，它包含了 /init 文件和一些配置文件。它用来挂载其他系统镜像并启动 init 进程。<br>    userdata.img：将被挂载为 /data，包含了应用程序相关的数据以及和用户相关的数据。</p>
<p>原文较长，这里只转载了一部分。<br>原文地址：<a href="http://blog.csdn.net/huangyabin001/article/details/36383031" target="_blank" rel="external">http://blog.csdn.net/huangyabin001/article/details/36383031</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[来电翻转静音与免提自动切换听筒功能的实现]]></title>
      <url>http://yoursite.com/2016/08/20/%E6%9D%A5%E7%94%B5%E7%BF%BB%E8%BD%AC%E9%9D%99%E9%9F%B3%E4%B8%8E%E5%85%8D%E6%8F%90%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2%E5%90%AC%E7%AD%92%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      <content type="html"><![CDATA[<p>在来电的过程中，我们往往会通过对sensor（传感器）的监听来实现一些手机状态的自动切换，这些功能的实现往往通过以下几个步骤:</p>
<ol>
<li>获得SensorManager并通过SensorManager取得某一具体需要的Sensor对象，并注册监听；</li>
<li>重写其onSensorChanged(SensorEvent event)方法，在该方法中需要通过event对象获得sensor的具体数值，并需要对该数值进行判断，来确定是否满足我们预期进行功能或状态切换的条件，而这些条件即<strong>sensor具体数值的确定</strong>是整个功能实现的难点；</li>
<li>在使用完后要对sensor进行解绑，因为sensor的开启将会十分耗电。</li>
</ol>
<h2 id="来电翻转静音"><a href="#来电翻转静音" class="headerlink" title="来电翻转静音"></a>来电翻转静音</h2><p>这段代码截取自 InCallActivity.java，这段代码实现了来电翻转静音的功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SensorManagerHelper</span> <span class="keyword">implements</span> <span class="title">SensorEventListener</span> </span>&#123; <span class="comment">// 声明一个实现了SensorEventListener接口内部类</span></div><div class="line">    <span class="keyword">private</span> SensorManager sensorManager;<span class="comment">//一些变量的声明</span></div><div class="line">    <span class="keyword">private</span> Sensor sensor;</div><div class="line">    <span class="keyword">private</span> Context context;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isUpdate = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sensorStatusFlag = <span class="number">1</span>;</div><div class="line">    <span class="comment">// TYPE_GRAVITY</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> upturn = <span class="keyword">false</span>; <span class="comment">// turn before</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> downturn = <span class="keyword">false</span>; <span class="comment">// turn after</span></div><div class="line">    <span class="comment">// TYPE_ACCELEROMETER</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> screenUp = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SensorManagerHelper</span><span class="params">(Context context)</span> </span>&#123;<span class="comment">//在构造方法中调用init()方法</span></div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        <span class="keyword">this</span>.context = context;</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        Log.d(<span class="keyword">this</span>,<span class="string">"SensorManagerHelper init"</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == sensorManager) &#123;</div><div class="line">            sensorManager = (SensorManager) context.getSystemService(Context.SENSOR_SERVICE);<span class="comment">//取得SensorManager对象</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != sensorManager &amp;&amp; <span class="keyword">null</span> == sensor) &#123;</div><div class="line">            sensor = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);<span class="comment">//优先选择ACCELEROMETERSensor（加速度传感器）</span></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == sensor) &#123;</div><div class="line">                sensor = sensorManager.getDefaultSensor(Sensor.TYPE_GRAVITY);<span class="comment">//如果没有ACCELEROMETERSensor就尝试去获取GRAVITYSensor（重力传感器）</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != sensor) &#123;<span class="comment">//如果获取到了ACCELEROMETERSensor或者GRAVITYSensor 就讲标志位设为true并注册监听</span></div><div class="line">            isUpdate = <span class="keyword">true</span>;</div><div class="line">            sensorManager.registerListener(<span class="keyword">this</span>, sensor, SensorManager.SENSOR_DELAY_NORMAL);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSensorChanged</span><span class="params">(SensorEvent event)</span> </span>&#123;<span class="comment">//重写onSensorChanged(SensorEvent event)方法</span></div><div class="line">        <span class="keyword">if</span> (!isUpdate) &#123; <span class="comment">//如果在init()方法中没有获取到sensor或已经成功回调了一次change方法就直接跳出</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (event.sensor.getType() == Sensor.TYPE_GRAVITY) &#123;<span class="comment">//change事件为GRAVITYSensor</span></div><div class="line">            <span class="keyword">float</span> z = event.values[<span class="number">2</span>];<span class="comment">//获得Z轴方向上的重力加速度</span></div><div class="line"></div><div class="line">            <span class="keyword">if</span> (z &gt;= <span class="number">8</span>) &#123;<span class="comment">//当Z方向的值大于8时，（g约等于9.8），便认为是正面手机朝上的状态</span></div><div class="line">                upturn = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (upturn &amp;&amp; (z &lt;= -<span class="number">8</span>)) &#123;<span class="comment">//反之则为认为手机翻转</span></div><div class="line">                downturn = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (downturn) &#123;</div><div class="line">                isUpdate = <span class="keyword">false</span>;</div><div class="line">                mute();<span class="comment">//翻转则静音，调用mute（）方法</span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (event.sensor.getType() == Sensor.TYPE_ACCELEROMETER) &#123;<span class="comment">//为ACCELEROMETERSensro的情况</span></div><div class="line">            <span class="keyword">float</span> x = event.values[<span class="number">0</span>];</div><div class="line">            <span class="keyword">float</span> y = event.values[<span class="number">1</span>];</div><div class="line">            <span class="keyword">if</span> (x &gt; -<span class="number">1</span> &amp;&amp; x &lt; <span class="number">1</span>) &#123;</div><div class="line">                sensorStatusFlag = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (sensorStatusFlag == <span class="number">0</span> &amp;&amp; (x &gt; <span class="number">8</span> || x &lt; -<span class="number">8</span> || y &gt; <span class="number">8</span> || y &lt; -<span class="number">8</span>)) &#123;<span class="comment">//这里这个判断的意思是，开始时手机为水平状态，X方向无重力加度度，当来电后，若用户翻转手机，在翻转过程中，必然会出现重力加速度全部分到X或Y轴的情况（可以拿手机自己演示一下）</span></div><div class="line">                isUpdate = <span class="keyword">false</span>;</div><div class="line">                mute();</div><div class="line">                sensorStatusFlag = <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAccuracyChanged</span><span class="params">(Sensor sensor, <span class="keyword">int</span> accuracy)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopListen</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != sensorManager &amp;&amp; <span class="keyword">null</span> != sensor) &#123;<span class="comment">//先判断sensorManager和sensor是否为空，不空则解绑</span></div><div class="line">            sensorManager.unregisterListener(<span class="keyword">this</span>);</div><div class="line">        &#125;</div><div class="line">        upturn = <span class="keyword">false</span>;</div><div class="line">        downturn = <span class="keyword">false</span>;</div><div class="line">        screenUp = <span class="keyword">false</span>;</div><div class="line">        isUpdate = <span class="keyword">true</span>;</div><div class="line">        sensorStatusFlag = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">mute</span><span class="params">()</span> </span>&#123;<span class="comment">//调用TelecomManager中的silenceRinger()方法，实现静音</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            getTelecomManager().silenceRinger();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p> 　　　　　　　　　　　　<img src="http://www.android-doc.com/images/axis_device.png" alt=""><br>The X axis is horizontal and points to the right, the Y axis is vertical and points up and the Z axis points towards the outside of the front face of the screen. In this system, coordinates behind the screen have negative Z values.</p>
</blockquote>
<p><a href="http://www.android-doc.com/reference/android/hardware/SensorEvent.html#values" target="_blank" rel="external">http://www.android-doc.com/reference/android/hardware/SensorEvent.html#values</a></p>
<p>该内部类在onStart()方法中new出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (Log.DEBUG) Log.d(TAG, <span class="string">"enter onStart()..."</span>);</div><div class="line">        <span class="keyword">super</span>.onStart();</div><div class="line">        <span class="keyword">if</span> (isRotatingMuteSupport()) &#123;<span class="comment">//判断翻转静音功能的开关</span></div><div class="line">            mSensorManagerHelper = <span class="keyword">new</span> SensorManagerHelper(getApplicationContext());</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">``` </div><div class="line">在onStop()方法中完成了解绑：</div><div class="line">``` <span class="function">java</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> &#123;</div><div class="line">        ...</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mSensorManagerHelper) &#123;</div><div class="line">            mSensorManagerHelper.stopListen();</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="来电拿起接听自动切换话筒"><a href="#来电拿起接听自动切换话筒" class="headerlink" title="来电拿起接听自动切换话筒"></a>来电拿起接听自动切换话筒</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtraSensorManagerHelper</span> <span class="keyword">implements</span> <span class="title">SensorEventListener</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> SensorManager sensorManager;</div><div class="line">        <span class="keyword">private</span> Sensor accelerOmeterSensor;</div><div class="line">        <span class="keyword">private</span> Sensor proximitySensor;</div><div class="line">        <span class="keyword">private</span> Context context;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isClear = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">float</span> x = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">float</span> y = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">float</span> z = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAudioMode</span><span class="params">(<span class="keyword">int</span> mode)</span> </span>&#123;</div><div class="line">            Log.d(<span class="string">"chenxianboExtra"</span>, <span class="string">"Sending new Audio Mode: "</span> + AudioState.audioRouteToString(mode));</div><div class="line">            TelecomAdapter.getInstance().setAudioRoute(mode);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">       ... <span class="comment">//初始化等相同部分省略，不再赘述</span></div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSensorChanged</span><span class="params">(SensorEvent event)</span> </span>&#123;</div><div class="line">            Log.d(<span class="string">"chenxianboExtra"</span>,<span class="string">"onSensorChangedEvent"</span>);</div><div class="line">            <span class="keyword">if</span> (event.sensor.getType() == Sensor.TYPE_PROXIMITY) &#123;<span class="comment">//首先判断是否贴近</span></div><div class="line">                    x = event.values[<span class="number">0</span>];</div><div class="line">                    <span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</div><div class="line">                      isClear = <span class="keyword">true</span>;</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                      isClear = <span class="keyword">false</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (event.sensor.getType() == Sensor.TYPE_ACCELEROMETER) &#123;</div><div class="line">                    x = event.values[<span class="number">0</span>];</div><div class="line">                    y = event.values[<span class="number">1</span>];</div><div class="line">                    z = event.values[<span class="number">2</span>];</div><div class="line">                    Log.d(<span class="string">"chenxianboExtra"</span>,<span class="string">"Sensor.TYPE_ACCELEROMETER value "</span>  + x + y + z);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (!isClear) &#123;<span class="comment">//如果未贴近耳朵则跳出该方法</span></div><div class="line">                    Log .d(<span class="string">"chenxianboExtra"</span>,<span class="string">"!isClear"</span>);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">            Log.d(<span class="string">"chenxianboExtra"</span>,<span class="string">"isSpeakerPhone"</span> + isSpeakerPhone());</div><div class="line">            <span class="keyword">if</span> (x &lt; <span class="number">9.0</span> &amp;&amp; y &gt; <span class="number">4.0</span> &amp;&amp; y &lt; <span class="number">8.2</span> &amp;&amp; z &gt; -<span class="number">0.8</span> &amp;&amp; isSpeakerPhone()) &#123;<span class="comment">//当用户手机贴近了耳朵，并以一定的角度持手机时且当前为免提状态，则认为符合条件，切换为听筒状态</span></div><div class="line">                    setAudioMode(AudioState.ROUTE_EARPIECE);</div><div class="line">                &#125;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">   ... <span class="comment">//相同部分略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上文所述，在整个功能的实现中，难点在于对sensor数值的判断，我在写此功能时，通过不断模仿用户使用场景，并将sensor的值在log中打出，观察X、Y、Z轴的数值变换，以此来确定符合用户场景的特定sensor值。</p>
<blockquote>
<p>08-10 17:54:47.930 D/InCall  ( 2107): chenxianboExtra - !isClear<br>08-10 17:54:47.931 D/InCall  ( 2107): chenxianboExtra - onSensorChangedEvent<br>08-10 17:54:47.931 D/InCall  ( 2107): chenxianboExtra - onSensorChanged  =============================================<br>08-10 17:54:47.931 D/InCall  ( 2107): chenxianboExtra - event.sensor.getType() = 1<br>08-10 17:54:47.931 D/InCall  ( 2107): chenxianboExtra - onSensorChanged  0.116 , 4.396 , 8.22<br>08-10 17:54:47.931 D/InCall  ( 2107): chenxianboExtra - Sensor.TYPE_ACCELEROMETER value test0.1164.3968.22<br>08-10 17:54:47.932 D/InCall  ( 2107): chenxianboExtra - !isClear<br>08-10 17:54:47.932 D/InCall  ( 2107): chenxianboExtra - onSensorChangedEvent<br>08-10 17:54:47.932 D/InCall  ( 2107): chenxianboExtra - onSensorChanged  =============================================<br>08-10 17:54:47.932 D/SurfaceFlinger(  303): postEvent(1312, v/c=1032)<br>08-10 17:54:47.932 D/SurfaceFlinger(  303): postEvent(303, v/c=5073)<br>08-10 17:54:47.934 V/DisplayEventReceiver( 1312): call nativeScheduleVsync mReceiverPtr = 547378982528<br>08-10 17:54:47.934 D/SurfaceFlinger(  303): requestNextVsync(1312)<br>08-10 17:54:47.934 D/InCall  ( 2107): chenxianboExtra - event.sensor.getType() = 1<br>08-10 17:54:47.935 D/InCall  ( 2107): chenxianboExtra - onSensorChanged  0.078 , 4.469 , 8.449</p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[教你快刀斩乱麻般的抓住进程和线程的区别]]></title>
      <url>http://yoursite.com/2016/08/14/%E6%95%99%E4%BD%A0%E5%BF%AB%E5%88%80%E6%96%A9%E4%B9%B1%E9%BA%BB%E8%88%AC%E7%9A%84%E6%8A%93%E4%BD%8F%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      <content type="html"><![CDATA[<p>相信大家学习操作系统时都书上看到了密密麻麻写的几张纸的进程与线程的关系的分析，但是初学者看完之后往往会感觉很乱，抓不住主要矛盾，这里就教你一针见血的指出进程（preocess)与线程(thread)的区别。<br><br><br>首先谷歌一下，看看国外的大牛都是怎么说的：</p>
<p><img src="https://raw.githubusercontent.com/XianboChen/MyBlog/master/picture/process_thread.PNG" alt=""><br><br><br>哈哈，看来大家都对这个问题很有兴趣啊，有很多的讨论帖子，这里选取两个贴上：</p>
<blockquote>
<p>Both processes and threads are independent sequences of execution. The typical difference is that threads (of the same process) run in a shared memory space, while processes run in separate memory spaces.</p>
<p>Erlang uses the term “process” because it does not expose a shared-memory multiprogramming model. Calling them “threads” would imply that they have shared memory.</p>
</blockquote>
<p><a href="http://stackoverflow.com/questions/200469/what-is-the-difference-between-a-process-and-a-thread" target="_blank" rel="external">http://stackoverflow.com/questions/200469/what-is-the-difference-between-a-process-and-a-thread</a></p>
<blockquote>
<p>Processes vs Threads</p>
<p>A process is an executing instance of an application. What does that mean? Well, for example, when you double-click the Microsoft Word icon, you start a process that runs Word. A thread is a path of execution within a process. Also, a process can contain multiple threads. When you start Word, the operating system creates a process and begins executing the primary thread of that process.</p>
<p>It’s important to note that a thread can do anything a process can do. But since a process can consist of multiple threads, a thread could be considered a ‘lightweight’ process. Thus, the essential difference between a thread and a process is the work that each one is used to accomplish. Threads are used for small tasks, whereas processes are used for more ‘heavyweight’ tasks – basically the execution of applications.</p>
<p>Another difference between a thread and a process is that threads within the same process share the same address space, whereas different processes do not. This allows threads to read from and write to the same data structures and variables, and also facilitates communication between threads. Communication between processes – also known as IPC, or inter-process communication – is quite difficult and resource-intensive.</p>
</blockquote>
<p><a href="http://www.programmerinterview.com/index.php/operating-systems/thread-vs-process/" target="_blank" rel="external">http://www.programmerinterview.com/index.php/operating-systems/thread-vs-process/</a></p>
<blockquote>
<p>Here is the analogy I use in Linux Kernel Development. Processes are the abstraction of running programs: A binary image, virtualized memory, various kernel resources, an associated security context, and so on. Threads are the unit of execution in a process: A virtualized processor, a stack, and program state. Put another way, processes are running binaries and threads are the smallest unit of execution schedulable by an operating system’s process scheduler.</p>
</blockquote>
<p><a href="https://www.quora.com/What-is-the-difference-between-a-process-and-a-thread" target="_blank" rel="external">https://www.quora.com/What-is-the-difference-between-a-process-and-a-thread</a></p>
<p>好了，看到这里我觉得如果要我一针见血的指出进程与线程的区别，我觉得可以这么说：<br><strong>线程是一种在同一进程中可以共享资源的轻量级（lightweight）进程</strong></p>
<p>当然这是一种很浅白的说法，关于进程与线程的理解还有很多，大家可以自行google。不过我觉得对于一种模糊的概念应该首先快刀斩乱麻般的找到他们的痛点，那么接下来的研究就简单多了。</p>
<p>这篇博客也对进程与线程做了形象的描述，大家也可以参考看下：<br><a href="http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html</a></p>
<p>下面这段话很好的说明了线程存在的意义：</p>
<blockquote>
<p>What’s the point? We obviously need processes. But why introduce the separate concept of a thread and allow multithreaded processes? There are four primary benefits to multithreading:</p>
<p><strong>Programming  abstraction</strong>. Dividing up work and assigning each division to a unit of execution (a thread) is a natural approach to many problems. Programming patterns that utilize this approach include the reactor, thread-per-connection, and thread pool patterns. Some, however, view threads as an anti-pattern. The inimitable Alan Cox summed this up well with the quote, “threads are for people who can’t program state machines.”<br><strong>Parallelism</strong>. In machines with multiple processors, threads provide an efficient way to achieve true parallelism. As each thread receives its own virtualized processor and is an independently-schedulable entity, multiple threads may run on multiple processors at the same time, improving a system’s throughput. To the extent that threads are used to achieve parallelism—that is, there are no more threads than processors—the “threads are for people who can’t program state machines” quote does not apply.<br><strong>Blocking I/O</strong>. Without threads, blocking I/O halts the whole process. This can be detrimental to both throughput and latency. In a multithreaded process, individual threads may block, waiting on I/O, while other threads make forward progress. Asynchronous &amp; non-blocking I/O are alternative solutions to threads for this issue.<br><strong>Memory savings</strong>. Threads provide an efficient way to share memory yet utilize multiple units of execution. In this manner they are an alternative to multiple processes.</p>
</blockquote>
<p><a href="https://www.quora.com/What-is-the-difference-between-a-process-and-a-thread" target="_blank" rel="external">https://www.quora.com/What-is-the-difference-between-a-process-and-a-thread</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Shell简单学习]]></title>
      <url>http://yoursite.com/2016/07/29/Shell%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/</url>
      <content type="html"><![CDATA[<p>最近学习简单看了点shell脚本的语法，在此来记下与C、java语言不同的语法点，方便以后查看。<br>首先要明确两个概念：Shell脚本与Shell<br><a href="https://zh.wikipedia.org/wiki/Shell%E8%84%9A%E6%9C%AC" target="_blank" rel="external"><strong>Shell script（shell 脚本）</strong></a>，是一种电脑程序与文本文件，内容由一连串的shell命令组成，经由Unix Shell直译其内容后运作。被当成是一种脚本语言来设计，其运作方式与直译语言相当，由Unix shell扮演命令行解释器的角色，在读取shell script之后，依序运行其中的shell命令，之后输出结果。<br><a href="https://zh.wikipedia.org/wiki/Shell%E8%84%9A%E6%9C%AC" target="_blank" rel="external"><strong>Shell</strong></a>,“为用户提供用户界面”的软件，通常指的是命令行界面的解析器。一般来说，这个词是指操作系统中，提供访问内核所提供之服务的程序。Shell也用于泛指所有为用户提供操作界面的程序，也就是程序和用户交互的层面。因此与之相对的是程序内核（Core），内核不提供和用户的交互功能。<br>我们一般称shell编程是指shell脚本的编程，不是指开发shell，这点概念要分清。</p>
<h3 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h3><p>使用一个定义过的变量，只要在变量名前面加美元符号($)即可:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">your_name=<span class="string">"xianbo"</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$your_name</span></div></pre></td></tr></table></figure></p>
<p>执行的时候记得加上可执行权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod +x ./test.sh  <span class="comment">#使脚本具有执行权限</span></div><div class="line">./test.sh  <span class="comment">#执行脚本</span></div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>xianbo</p>
<h3 id="获取字符串长度"><a href="#获取字符串长度" class="headerlink" title="获取字符串长度"></a>获取字符串长度</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">string=&quot;abcd&quot;</div><div class="line">echo $&#123;#string&#125; #输出 4</div></pre></td></tr></table></figure>
</blockquote>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">my_array=(A B &quot;C&quot; D)</div><div class="line">echo &quot;第一个元素为: $&#123;my_array[0]&#125;&quot;</div><div class="line">echo &quot;第二个元素为: $&#123;my_array[1]&#125;&quot;</div><div class="line">echo &quot;第三个元素为: $&#123;my_array[2]&#125;&quot;</div><div class="line">echo &quot;第四个元素为: $&#123;my_array[3]&#125;&quot;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<blockquote>
<p>第一个元素为: A<br>第二个元素为: B<br>第三个元素为: C<br>第四个元素为: D</p>
</blockquote>
<h3 id="基本运算符"><a href="#基本运算符" class="headerlink" title="基本运算符"></a>基本运算符</h3><p>1.原生bash不支持简单的数学运算，但是可以通过其他命令来实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">val=`expr 2 + 2`</div><div class="line">echo &quot;两数之和为 : $val&quot;</div><div class="line">val=`expr $a \* $b`</div><div class="line">echo &quot;a * b : $val&quot;</div></pre></td></tr></table></figure></p>
<p>运行结果:</p>
<blockquote>
<p>两数之和为 : 4<br>a <em> b : 200<br>这里要注意乘号</em>需要使用转移符</p>
</blockquote>
<p>2.使用方括号与美元符的方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a=$[2+2]</div><div class="line">b=$[2 - 1]</div><div class="line">c=$[2 / 2]</div><div class="line">d=$[2 * 2]</div><div class="line">echo $a $b $c $d</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>4 1 1 4<br>while语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">int=1</div><div class="line">while(($int&lt;=5 ))</div><div class="line">do</div><div class="line">        echo $int</div><div class="line">        let &quot;int++&quot;</div><div class="line">done</div></pre></td></tr></table></figure></p>
</blockquote>
<p>运行结果：</p>
<blockquote>
<p>1<br>2<br>3<br>4<br>5</p>
</blockquote>
<h3 id="Shell函数"><a href="#Shell函数" class="headerlink" title="Shell函数"></a>Shell函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">funWithReturn()&#123;</div><div class="line">    echo &quot;这个函数会对输入的两个数字进行相加运算...&quot;</div><div class="line">    echo &quot;输入第一个数字: &quot;</div><div class="line">    read aNum</div><div class="line">    echo &quot;输入第二个数字: &quot;</div><div class="line">    read anotherNum</div><div class="line">    echo &quot;两个数字分别为 $aNum 和 $anotherNum !&quot;</div><div class="line">    return $(($aNum+$anotherNum))</div><div class="line">&#125;</div><div class="line">funWithReturn</div><div class="line">echo &quot;输入的两个数字之和为 $? !&quot;</div></pre></td></tr></table></figure>
<p>运行结果:</p>
<blockquote>
<p>这个函数会对输入的两个数字进行相加运算…<br>输入第一个数字:<br>1<br>输入第二个数字:<br>3<br>两个数字分别为 1 和 3 !<br>输入的两个数字之和为 4 !</p>
</blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>可以带function fun() 定义，也可以直接fun() 定义,不带任何参数。</li>
<li>参数返回，可以显示加：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。</li>
<li>函数返回值在调用该函数后通过 $? 来获得。</li>
<li>所有函数在使用前必须定义。这意味着必须将函数放在脚本开始部分，直至shell解释器首次发现它时，才可以使用。调用函数仅使用其函数名即可。</li>
</ul>
<h3 id="参数函数"><a href="#参数函数" class="headerlink" title="参数函数"></a>参数函数</h3><p>在Shell中，调用函数时可以向其传递参数。在函数体内部，通过$n的形式来获取参数的值，例如，$1表示第一个参数，$2表示第二个参数…以此类推<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">funWithParam()&#123;</div><div class="line">    echo &quot;第一个参数为 $1 !&quot;</div><div class="line">    echo &quot;第二个参数为 $2 !&quot;</div><div class="line">    echo &quot;第十个参数为 $10 !&quot;</div><div class="line">    echo &quot;第十个参数为 $&#123;10&#125; !&quot;</div><div class="line">    echo &quot;第十一个参数为 $&#123;11&#125; !&quot;</div><div class="line">    echo &quot;参数总数有 $# 个!&quot;</div><div class="line">    echo &quot;作为一个字符串输出所有参数 $* !&quot;</div><div class="line">&#125;</div><div class="line">funWithParam 1 2 3 4 5 6 7 8 9 34 73</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>第一个参数为 1 !<br>第二个参数为 2 !<br>第十个参数为 10 !<br>第十个参数为 34 !<br>第十一个参数为 73 !<br>参数总数有 11 个!<br>作为一个字符串输出所有参数 1 2 3 4 5 6 7 8 9 34 73 !</p>
</blockquote>
<h3 id="IO重定向"><a href="#IO重定向" class="headerlink" title="IO重定向"></a>IO重定向</h3><p>>为输出流<br>>&gt;为不覆盖的输出流<br>&lt; 、&lt;&lt;为输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &quot;IO test&quot; &gt; test0728</div></pre></td></tr></table></figure></p>
<p>执行后，生成test0728文件，文件内容为：</p>
<blockquote>
<p>IO test</p>
</blockquote>
<p>需要注意的是文件描述符:<br>0通常是标准输入（STDIN）,1是标准输出（STDOUT）,2是标准错误输出（STDERR）。<br>像在Android中常用的编译命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make -j8 2&gt;&amp;1 | tee build.log</div></pre></td></tr></table></figure></p>
<p>2是标准错误，&amp;1是标准输出，2&gt;&amp;1意思就是将标准错误输出到标准输出中。<br>如果没有2&gt;&amp;1,只会有标准输出，没有错误；<br>tee的作用同时输出到控制台和文件<br>make &gt; build.log  是将所有标准输出到这个文件中，并没有定义标准错误应该是定义到了标准输出，也就是说如果make执行出现错误，那么就不会写到 build.log中，而是输出到屏幕上，<br>2&gt;&amp;1是错误和结果都重定向到build.log中！<br>最后可以到根目录看到 build.log</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Java多线程浅谈（一）]]></title>
      <url>http://yoursite.com/2016/07/26/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B5%85%E8%B0%88%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      <content type="html"><![CDATA[<p>实现java多线程主要有两种方法：继承Thread类和实现runnable接口。</p>
<h2 id="1、继承java-lang-Thread类"><a href="#1、继承java-lang-Thread类" class="headerlink" title="1、继承java.lang.Thread类"></a>1、继承java.lang.Thread类</h2><p>1.创建一个继承于Thread的子类；<br>2.重写Thread类的run（）方法,方法内实现子线程要完成的功能；<br>3.创建一个子类的对象；<br>4.调用其start（）方法，启动线程，调用run（）方法。<br>demo：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		<span class="comment">//3.创建一个子类的对象</span></div><div class="line">		SubThread st1 = <span class="keyword">new</span> SubThread();</div><div class="line">		SubThread st2 = <span class="keyword">new</span> SubThread();</div><div class="line">		<span class="comment">//4.调用其start（）方法，启动线程，调用run（）方法</span></div><div class="line">		st1.start();</div><div class="line">		st2.start();	</div><div class="line">		<span class="comment">//st.start();</span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</div><div class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + i);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//1.创建一个继承于Thread的子类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">	<span class="comment">//2.重写Thread类的run（）方法,方法内实现子线程要完成的功能</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</div><div class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + i);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>main:1<br>main:2<br>Thread-1:1<br>Thread-0:1<br>Thread-1:2<br>main:3<br>Thread-1:3<br>Thread-0:2<br>Thread-1:4<br>main:4<br>Thread-1:5<br>Thread-1:6<br>Thread-0:3<br>Thread-1:7<br>main:5<br>Thread-1:8<br>Thread-0:4<br>Thread-1:9<br>main:6<br>main:7<br>Thread-1:10<br>Thread-0:5<br>Thread-1:11<br>main:8<br>Thread-1:12<br>Thread-0:6<br>Thread-1:13<br>main:9<br>Thread-1:14<br>Thread-0:7<br>Thread-1:15<br>…（以下省略）</p>
</blockquote>
<p><strong>这里要注意：</strong> </p>
<ul>
<li>一个线程只能执行一次start()方法，在java源码中start()方法被关键字synchronized修饰，同时对threadStatus进行了判断，非0抛IllegalThreadStateException()异常；</li>
<li>不能通过Thread实现类对象的run()方法去启动一个线程。</li>
</ul>
<h3 id="Thread的常用方法："><a href="#Thread的常用方法：" class="headerlink" title="Thread的常用方法："></a>Thread的常用方法：</h3><ul>
<li>start():启动线程并执行相应的run()方法;</li>
<li>run()：子线程要执行的代码放入run()方法中;</li>
<li>currentThread():静态的，取到当前的线程；</li>
<li>getName():取到线程的名字；</li>
<li>setName():设置此线程的名字</li>
<li>yield(): 调用此方法的线程释放当前CPU的执行权，重回可执行状态，<strong>但并不意味着CPU接下来不会执行该线程，该线程仍然可能抢到CPU</strong>；</li>
<li>join():在A线程中调用B线程的join()方法，表示当执行到此方法时，A线程停止执行，直至B线程执行完毕,A线程再接着jion()之后的代码执行；</li>
<li>isAlive():判断当前线程是否还存活；</li>
<li>sleep(long l):显式的让当前进程睡眠1毫秒；</li>
<li>线程通信：wait() notify() notifyAll()</li>
<li>设置进程的优先级：<ul>
<li>getPriority():返回进程优先值 （0-10），static final 的值 , 10最大</li>
<li>setPriority(int newPriority):改变进程的优先级</li>
</ul>
</li>
</ul>
<p>demo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		<span class="comment">//3.创建一个子类的对象</span></div><div class="line">		SubThread st1 = <span class="keyword">new</span> SubThread();</div><div class="line">		SubThread st2 = <span class="keyword">new</span> SubThread();</div><div class="line">		<span class="comment">//4.调用其start（）方法，启动线程，调用run（）方法</span></div><div class="line">		st1.setName(<span class="string">"子线程"</span>);</div><div class="line">		st1.setPriority(Thread.MAX_PRIORITY);</div><div class="line">		st1.start();</div><div class="line">		Thread.currentThread().setName(<span class="string">"========主线程"</span>);</div><div class="line">		<span class="comment">//st.start();</span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</div><div class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> +</div><div class="line">					Thread.currentThread().getPriority() + <span class="string">" "</span> + i);</div><div class="line"><span class="comment">//			if(i % 10 == 0) &#123;</span></div><div class="line"><span class="comment">//				Thread.currentThread().yield();</span></div><div class="line"><span class="comment">//			&#125;</span></div><div class="line"><span class="comment">//			if(i == 20) &#123;</span></div><div class="line"><span class="comment">//				try &#123;</span></div><div class="line"><span class="comment">//					st1.join();</span></div><div class="line"><span class="comment">//				&#125; catch (InterruptedException e) &#123;</span></div><div class="line"><span class="comment">//					// TODO Auto-generated catch block</span></div><div class="line"><span class="comment">//					e.printStackTrace();</span></div><div class="line"><span class="comment">//				&#125;</span></div><div class="line"><span class="comment">//			&#125;</span></div><div class="line">		&#125;</div><div class="line">		System.out.println(st1.isAlive());</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//1.创建一个继承于Thread的子类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">	<span class="comment">//2.重写Thread类的run（）方法,方法内实现子线程要完成的功能</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</div><div class="line"><span class="comment">//			try &#123;</span></div><div class="line"><span class="comment">//				Thread.currentThread().sleep(1000);</span></div><div class="line"><span class="comment">//			&#125; catch (InterruptedException e) &#123;</span></div><div class="line"><span class="comment">//				// TODO Auto-generated catch block</span></div><div class="line"><span class="comment">//				e.printStackTrace();</span></div><div class="line"><span class="comment">//			&#125;</span></div><div class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> +</div><div class="line">					Thread.currentThread().getPriority() + <span class="string">" "</span> + i);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="2、实现runnable接口"><a href="#2、实现runnable接口" class="headerlink" title="2、实现runnable接口"></a>2、实现runnable接口</h2><p>1.创建一个实现了Runnable借口的类；<br>2.实现接口的抽象方法；<br>3.创建一个Runnable接口的实现类；<br>4.将此对象作为行参传递给Thread类的构造器中，创建Thread的对象，此对象即为一个线程；<br>5.调用start()方法，启动线程并执行run()。<br>demo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TsetThread1</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		<span class="comment">//3.创建一个Runnable接口的实现类</span></div><div class="line">		PrintNum1 p = <span class="keyword">new</span> PrintNum1();</div><div class="line">		<span class="comment">//p.run();</span></div><div class="line">		<span class="comment">//p.start();</span></div><div class="line">		<span class="comment">//要想启动一个多线程，必须调用start()</span></div><div class="line">		<span class="comment">//4.将此对象作为行参传递给Thread类的构造器中，创建Thread的对象，此对象即为一个线程</span></div><div class="line">		Thread t1 = <span class="keyword">new</span> Thread(p);</div><div class="line">		<span class="comment">//5.调用start()方法，启动线程并执行run()</span></div><div class="line">		t1.start();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</div><div class="line">			<span class="keyword">if</span> (i % <span class="number">2</span> != <span class="number">0</span>) &#123;</div><div class="line">				System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + i);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//1.创建一个实现了Runnable借口的类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintNum1</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="comment">//2.实现接口的抽象方法</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</div><div class="line">			<span class="keyword">if</span> (i % <span class="number">2</span> ==<span class="number">0</span>) &#123;</div><div class="line">				System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + i);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>main:1<br>Thread-0:2<br>Thread-0:4<br>Thread-0:6<br>Thread-0:8<br>Thread-0:10<br>main:3<br>main:5<br>main:7<br>Thread-0:12<br>main:9<br>main:11<br>main:13<br>main:15<br>main:17<br>main:19<br>main:21<br>main:23<br>main:25<br>main:27<br>main:29<br>main:31<br>main:33<br>main:35<br>main:37<br>…(下略）<br><strong>这里要注意：</strong></p>
</blockquote>
<ul>
<li>要想启动一个线程，必须调用start()方法；</li>
<li>在java源码中    <pre><code>Thread t1 = new Thread(p);
 t1.start();
</code></pre>实际上是把P给了源码中target,再调用了target的run方法。</li>
</ul>
<h2 id="两种方式的比较"><a href="#两种方式的比较" class="headerlink" title="两种方式的比较"></a>两种方式的比较</h2><p>实现的方式较好：</p>
<ul>
<li>避免了java单继承的局限性</li>
<li>如果多个线程要操作同一份资源，更适合采用实现runnable接口的方式。</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Java反射浅谈（一）]]></title>
      <url>http://yoursite.com/2016/07/25/Java%E5%8F%8D%E5%B0%84%E6%B5%85%E8%B0%88%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      <content type="html"><![CDATA[<p>反射常用于各种框架中如:spring中的bean就是利用反射实现以及反编译中。<br>java.lang.Class是反射的源头。<br>创建一个类，通过编译（java.exe)，生成对应的.class文件，之后使用java.exe加载（JVM类加载器）此.class文件，此.calss文件加载到内存后，就是一个运行时类，存在缓冲区。这个运行类本身就是一个Class实例，一个运行时类只加载一次。有了Class实例后，我们才可以进行如下操作：<br>1、创建对应的运行时类的对象；<br>2、获取对象运行时类的完整结构（属性、方法、构造器、内部类、父类、所在包、异常、注解…)<br>3、调用对应运行时类的指定结构（属性、方法、构造器）<br>4、反射的应用：动态代理</p>
<h3 id="Java获取Class对象的四种方式"><a href="#Java获取Class对象的四种方式" class="headerlink" title="Java获取Class对象的四种方式"></a>Java获取Class对象的四种方式</h3><p>1、若已知具体的类，则首选通过类的class属性获取，该方法最为安全可靠，程序性能最高。<br>demo：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect;</div><div class="line"><span class="keyword">import</span> example.Person;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">ReflectionTest</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception  </span>&#123;	</div><div class="line">		Class clazz = Person.class; </div><div class="line">		<span class="comment">//1.创建clazz对应的运行时类Person类的对象</span></div><div class="line">		Person p = (Person) clazz.newInstance();   </div><div class="line">		<span class="comment">//2.通过反射调用运行时类的指定属性</span></div><div class="line">		Field f1 = clazz.getField(<span class="string">"name"</span>);</div><div class="line">        f1.set(p, <span class="string">"xianbo"</span>);</div><div class="line">        <span class="comment">//3.通过反射调用运行时类的指定方法</span></div><div class="line">       <span class="comment">// p.say();</span></div><div class="line">        Method m1 = clazz.getMethod(<span class="string">"say"</span>);</div><div class="line">        m1.invoke(p);</div><div class="line">	   &#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> example;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> String name = <span class="string">"tom"</span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Person</span> <span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"调用了Person()构造方法"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span> <span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"my name is "</span> + name);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<blockquote>
<p>调用了Person()构造方法<br>my name is xianbo</p>
</blockquote>
<p>2、通过运行时类的对象获取<br>demo:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect;</div><div class="line"><span class="keyword">import</span> example.Person;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">ReflectionTest</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception   </span>&#123;	</div><div class="line">		Person p = <span class="keyword">new</span> Person();</div><div class="line">		Class clazz = p.getClass();</div><div class="line">		System.out.println(clazz.getName());</div><div class="line">	   &#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>调用了Person()构造方法<br>example.Person</p>
</blockquote>
<p>3、已知一个类的全类名，且该类在类路径下，可通过Class类的静态方法forName()获取，可能抛出ClassNotFoundException异常。（反射的动态性）<br>demo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect;</div><div class="line"><span class="keyword">import</span> example.Person;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">ReflectionTest</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;	</div><div class="line">		String classname = <span class="string">"example.Person"</span>;</div><div class="line">		Class clazz = Class.forName(classname);</div><div class="line">		System.out.println(clazz.getName());</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>example.Person</p>
</blockquote>
<p>4、通过类的加载器<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect;</div><div class="line"><span class="keyword">import</span> example.Person;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">ReflectionTest</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> ClassNotFoundException  </span>&#123;	</div><div class="line">		ReflectionTest re = <span class="keyword">new</span> ReflectionTest();</div><div class="line">		re.test();</div><div class="line">	   &#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</div><div class="line">    String classname = <span class="string">"example.Person"</span>;</div><div class="line">	ClassLoader classLoader = <span class="keyword">this</span>.getClass().getClassLoader(); </div><div class="line">	<span class="comment">//Cannot use this in a static context</span></div><div class="line">	Class clazz = classLoader.loadClass(classname);</div><div class="line">	System.out.println(clazz.getName());</div><div class="line"> 	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>example.Person</p>
</blockquote>
<h3 id="创建运行时类的对象"><a href="#创建运行时类的对象" class="headerlink" title="创建运行时类的对象"></a>创建运行时类的对象</h3><p>在得到Class运行时类后，我们就可以通过newInstance()方法创建运行时类所对应的对象<br>domo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> example.Person;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConstructor</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		String className = <span class="string">"example.Person"</span>;</div><div class="line">		Class clazz = Class.forName(className);</div><div class="line">		<span class="comment">//创建运行时类的对象</span></div><div class="line">		Object obj = clazz.newInstance();</div><div class="line">		Person p = (Person)obj;</div><div class="line">		System.out.println(p);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<blockquote>
<p>调用了Person()构造方法<br>example.Person@4d871a69</p>
</blockquote>
<p>这里调用newInstance()实际上就是调用了运行时类的空参构造器，所以要想创建对象成功要满足两点：<br>1、对应的类要有空参的构造器；(没有空参的构造器也能通过其他的方法得到对象）<br>2、构造器的权限修饰符权限要足够。</p>
<h3 id="获取类的属性和方法"><a href="#获取类的属性和方法" class="headerlink" title="获取类的属性和方法"></a>获取类的属性和方法</h3><p>在得到类后，可以通过getField（）方法获取public的属性，还可以通过getDecllareFields()方法获取该类的所有属性。<br>demo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">		Class clazz = Person.class;</div><div class="line">		Field[] fields = clazz.getDeclaredFields();</div><div class="line">		<span class="keyword">for</span>(Field f : fields) &#123;</div><div class="line">			<span class="comment">//1.获取每个属性的权限修饰符</span></div><div class="line">			<span class="keyword">int</span> i = f.getModifiers();<span class="comment">//在java源码中，修饰符是一个个static final的数字</span></div><div class="line">			String str1 = Modifier.toString(i);</div><div class="line">			System.out.print(i + <span class="string">" "</span>  + str1 + <span class="string">" "</span> );</div><div class="line">			<span class="comment">//2.获取属性的类型</span></div><div class="line">			Class type = f.getType();</div><div class="line">			System.out.print(type + <span class="string">" "</span> + type.getName() + <span class="string">" "</span>);</div><div class="line">			<span class="comment">//3.获取属性名</span></div><div class="line">			System.out.println(f.getName());</div><div class="line">			System.out.println();</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> example;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    String name = <span class="string">"xianbo"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age = <span class="number">20</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> height = <span class="number">180</span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Person</span> <span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"调用了Person()构造方法"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span> <span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"my name is "</span> + name);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<blockquote>
<p>0  class java.lang.String java.lang.String name</p>
<p>1 public int int age</p>
<p>2 private float float height</p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Android6.0 Telephone 源码分析（一）]]></title>
      <url>http://yoursite.com/2016/07/22/Android6-0-source-code-first-anlysis/</url>
      <content type="html"><![CDATA[<h3 id="DialtactsActivity"><a href="#DialtactsActivity" class="headerlink" title="DialtactsActivity"></a>DialtactsActivity</h3><p>1、点击telephone APP ，通过抓log可以清楚的看到程序入口是DialtactsActivity.onClick()方法:<br><img src="https://raw.githubusercontent.com/XianboChen/MyBlog/master/picture/2.png" alt="2"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">switch</span> (view.getId()) &#123;<span class="comment">//对触发的buttonID进行判断</span></div><div class="line">            <span class="keyword">case</span> R.id.floating_action_button:<span class="comment">//点击的是“拨号”按钮</span></div><div class="line">                 <span class="keyword">if</span>(mListsFragment.getCurrentTabIndex()==ListsFragment.TAB_INDEX_ALL_CONTACTS&amp;&amp;!mInRegularSearch) &#123;       <span class="comment">//通过电话簿拨号</span></div><div class="line">                  DialerUtils.startActivityWithErrorToast(<span class="keyword">this</span>,IntentUtil.getNewContactIntent(), R.string.add_contact_not_available);</div><div class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (!mIsDialpadShown) &#123;<span class="comment">//拨号界面未显示，显示拨号界面</span></div><div class="line">                    mInCallDialpadUp = <span class="keyword">false</span>;</div><div class="line">                    showDialpadFragment(<span class="keyword">true</span>);<span class="comment">//在该方法中newl了DialpadFragment，实际上也就是交给了DialPadFragment去处理</span></div><div class="line">                &#125;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="keyword">case</span> R.id.voice_search_button:<span class="comment">//点击的是“声控搜索”按钮</span></div><div class="line"></div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line"></div><div class="line">                    ...  <span class="comment">//略</span></div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="keyword">case</span> R.id.dialtacts_options_menu_button:<span class="comment">//设置按钮</span></div><div class="line"></div><div class="line">              ....<span class="comment">//略</span></div><div class="line"></div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="keyword">default</span>: &#123;</div><div class="line"></div><div class="line">              ....<span class="comment">//略</span></div><div class="line"></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">       &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="DialPadFragment"><a href="#DialPadFragment" class="headerlink" title="DialPadFragment"></a>DialPadFragment</h3><p>2、调用showDialpadFragment()方法，在该方法中new出了DialPadFragment,此时进入类DialPadFragment中的onClick()方法（这里有两个DialPadFragment.java文件，一个在./dialpad文件夹中，还有一个在./incall文件夹中，这是在来电时调用的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKey</span><span class="params">(View view, <span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</div><div class="line">       <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">          <span class="keyword">case</span> R.id.digits:</div><div class="line">               <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_ENTER) &#123;<span class="comment">//如果是KEYCODE_ENTER，开始拨打</span></div><div class="line">                   handleDialButtonPressed();</div><div class="line">                   <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//自己处理了</span></div><div class="line">               &#125;</div><div class="line">           <span class="keyword">break</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;<span class="comment">//返回false由系统进行处理</span></div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>如果点击的是enter建，将会用handleDialButtonPressed()方法:</p>
<blockquote>
<p> /*<br>In most cases, when the dial button is pressed, there is a<br>number in digits area. Pack it in the intent, start the<br>outgoing call broadcast as a separate task and finish this activity.<br> When there is no digit and the phone is CDMA and off hook,<br>resending a blank flash for CDMA. CDMA networks use Flash<br>messages when special processing needs to be done, mainly for<br> 3-way or call waiting scenarios. Presumably, here we&#39;re in a<br>special 3-way scenario where the network needs a blank flash<br>before being able to add the new participant.  (This is not the<br>case with all 3-way calls, just certain CDMA infrastructures.)</p>
<p>Otherwise, there is no digit, display the last dialed number. Don&#39;t finish since the user may want to edit it. The<br>user needs to press the dial button again, to dial it (general<br> case described above).</p>
<p>*/</p>
</blockquote>
<p>*在大多数情况下，当拨号按钮被按下时都会有一串数字存在。从它的intent对象中得到它，开始</p>
<p>*呼叫广播作为一个单独的任务，并结束这个任务活动。</p>
<p>*如果没有数字并且CDMA网络处于占线状态时，</p>
<p>*我们发送一个空白的Flash CDMA。CDMA网络使用Flash</p>
<p>*来处理特殊处理的消息时，这里主要有三种方式</p>
<p>*以及呼叫等待的情景。这里我们应该属于</p>
<p>*前者，在能够添加新参与者之前,网络需要一个空白的Flash。</p>
<p>*若不是上面的情景，也不要结束这个Activity，应该显示上一次的电话号码</p>
<p>*并等待用户可能要编辑它。</p>
<p>*用户需要再次按拨号键，重新拨通（重复上面描述的案例）。</p>
<p> */</p>
<p>———–  部分翻译可能不够准确  ————</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleDialButtonPressed</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (isDigitsEmpty()) &#123; <span class="comment">//如果没有数字输入</span></div><div class="line"></div><div class="line">            handleDialButtonClickWithEmptyDigits();</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">           <span class="keyword">final</span> String number = mDigits.getText().toString();                        <span class="comment">//获取输入的电话号码</span></div><div class="line"></div><div class="line">            <span class="keyword">if</span> (number != <span class="keyword">null</span></div><div class="line">                    &amp;&amp; !TextUtils.isEmpty(mProhibitedPhoneNumberRegexp)</div><div class="line">                    &amp;&amp; number.matches(mProhibitedPhoneNumberRegexp)) &#123;                         <span class="comment">//对number过滤</span></div><div class="line">                Log.i(TAG, <span class="string">"The phone number is prohibited explicitly by a rule."</span>);</div><div class="line">               <span class="keyword">if</span> (getActivity() != <span class="keyword">null</span>) &#123;</div><div class="line">                    DialogFragment dialogFragment = ErrorDialogFragment.newInstance(</div><div class="line">                            R.string.dialog_phone_call_prohibited_message);</div><div class="line">                    dialogFragment.show(getFragmentManager(), <span class="string">"phone_prohibited_dialog"</span>);</div><div class="line"></div><div class="line">                &#125;</div><div class="line"></div><div class="line">                clearDialpad();                                            <span class="comment">//清除数字</span></div><div class="line"></div><div class="line">            &#125; <span class="keyword">else</span> &#123;                                              <span class="comment">//如果number通过了检查</span></div><div class="line"></div><div class="line">                <span class="keyword">final</span> Intent intent = CallUtil.getCallIntent(number,                  <span class="comment">//取得一个Callintent</span></div><div class="line"></div><div class="line"></div><div class="line">                        (getActivity() <span class="keyword">instanceof</span> DialtactsActivity ?</div><div class="line">                               ((DialtactsActivity) getActivity()).getCallOrigin() : <span class="keyword">null</span>));</div><div class="line"></div><div class="line">                              DialerUtils.startActivityWithErrorToast(getActivity(), intent);   <span class="comment">//交给DialerUtils去处理</span></div><div class="line">                hideAndClearDialpad(<span class="keyword">false</span>)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li><del>如果用户点击的不是enter键，onKey方法将会返回false,交给onPressed处理</del>（<em>这里暂存疑 </em>）。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPressed</span><span class="params">(View view, <span class="keyword">boolean</span> pressed)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (DEBUG) Log.d(TAG, <span class="string">"onPressed(). view: "</span> + view + <span class="string">", pressed: "</span> + pressed);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (pressed) &#123;                        <span class="comment">//这里继续对各个按键判断</span></div><div class="line">            <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">                <span class="keyword">case</span> R.id.one: &#123;</div><div class="line">                    keyPressed(KeyEvent.KEYCODE_1);  <span class="comment">//在keyPressed()方法中调用playTone（）方法，从而产生不同的按键声音效果</span></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">               ... 略</div><div class="line"></div><div class="line">                <span class="keyword">case</span> R.id.zero: &#123;</div><div class="line">                    keyPressed(KeyEvent.KEYCODE_0);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> R.id.pound: &#123;</div><div class="line">                    keyPressed(KeyEvent.KEYCODE_POUND);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> R.id.star: &#123;</div><div class="line">                    keyPressed(KeyEvent.KEYCODE_STAR);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">default</span>: &#123;</div><div class="line">                    Log.wtf(TAG, <span class="string">"Unexpected onTouch(ACTION_DOWN) event from: "</span> + view);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            mPressedDialpadKeys.add(view);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mPressedDialpadKeys.remove(view);</div><div class="line">           <span class="keyword">if</span> (mPressedDialpadKeys.isEmpty()) &#123;</div><div class="line">                stopTone();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>随后继续触发onClick方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">        <span class="keyword">case</span> R.id.dialpad_floating_action_button:                                  <span class="comment">//拨打按钮</span></div><div class="line">            mHaptic.vibrate();</div><div class="line">          handleDialButtonPressed();                                    <span class="comment">//再次交给了handleDialButton()方法</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="keyword">case</span> R.id.deleteButton: &#123;                                                  <span class="comment">//del按钮</span></div><div class="line">            keyPressed(KeyEvent.KEYCODE_DEL);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">       <span class="keyword">case</span> R.id.digits: &#123;                                             <span class="comment">//数字显示框，聚焦</span></div><div class="line"></div><div class="line">            <span class="keyword">if</span> (!isDigitsEmpty()) &#123;</div><div class="line">               mDigits.setCursorVisible(<span class="keyword">true</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">case</span> R.id.dialpad_overflow: &#123;</div><div class="line">            mOverflowPopupMenu.show();</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">default</span>: &#123;</div><div class="line">           Log.wtf(TAG, <span class="string">"Unexpected onClick() event from: "</span> + view);</div><div class="line">           <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>总之，在类DialPadFragment中完成了拨号，并将带着拨号数字的intent交给了类DialerUtils。 </strong></p>
<blockquote>
<p>DialerUtils.startActivityWithErrorToast(getActivity(), intent);</p>
</blockquote>
<h3 id="DialerUtils"><a href="#DialerUtils" class="headerlink" title="DialerUtils"></a>DialerUtils</h3><p>3、进入类DialerUtils.startActivityWithErrorToast()方法，这里有多个重载：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startActivityWithErrorToast</span><span class="params">(Context context, Intent intent, <span class="keyword">int</span> msgId)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;                                         <span class="comment">//判断Intent是否是ACTION_CALL</span></div><div class="line">            <span class="keyword">if</span> (Intent.ACTION_CALL.equals(intent.getAction())) &#123;</div><div class="line">                <span class="comment">// All dialer-initiated calls should pass the touch point to the InCallUI</span></div><div class="line">                Point touchPoint = TouchPointManager.getInstance().getPoint();</div><div class="line">               <span class="keyword">if</span> (touchPoint.x != <span class="number">0</span> || touchPoint.y != <span class="number">0</span>) &#123;</div><div class="line">                    Bundle extras = <span class="keyword">new</span> Bundle();</div><div class="line">                    extras.putParcelable(TouchPointManager.TOUCH_POINT, touchPoint);</div><div class="line">                    intent.putExtra(TelecomManager.EXTRA_OUTGOING_CALL_EXTRAS, extras);</div><div class="line">               &#125;</div><div class="line"></div><div class="line">                  <span class="keyword">final</span> TelecomManager tm = (TelecomManager)            <span class="comment">//获取TelecomManager服务</span></div><div class="line">                   context.getSystemService(Context.TELECOM_SERVICE);</div><div class="line">                  tm.placeCall(intent.getData(), intent.getExtras());</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                context.startActivity(intent);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (ActivityNotFoundException e) &#123;</div><div class="line">            Toast.makeText(context, msgId, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="TelecomManager"><a href="#TelecomManager" class="headerlink" title="TelecomManager"></a>TelecomManager</h3><p>4、进入类TelecomManager.placeCall()方法,此时已经在framework包下，进入了framework层：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">placeCall</span><span class="params">(Uri address, Bundle extras)</span> </span>&#123;</div><div class="line">        ITelecomService service = getTelecomService();<span class="comment">//获取TelecomService服务</span></div><div class="line">        <span class="keyword">if</span> (service != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (address == <span class="keyword">null</span>) &#123;</div><div class="line">                Log.w(TAG, <span class="string">"Cannot place call to empty address."</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                service.placeCall(address, extras == <span class="keyword">null</span> ? <span class="keyword">new</span> Bundle() : extras,</div><div class="line">                        mContext.getOpPackageName());<span class="comment">//交给Service去处理，进入Server端</span></div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                Log.e(TAG, <span class="string">"Error calling ITelecomService#placeCall"</span>, e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<hr>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Hello World(搭建问题解答）]]></title>
      <url>http://yoursite.com/2016/07/10/hello-world/</url>
      <content type="html"><![CDATA[<h3 id="欢迎来到陈贤波的个人博客"><a href="#欢迎来到陈贤波的个人博客" class="headerlink" title="欢迎来到陈贤波的个人博客"></a>欢迎来到陈贤波的个人博客</h3><p>本博客系统是利用hexo与github搭建而成，网上有很多总结的很少的搭建教程，就不在此赘述，感兴趣的话可以自行百度相关关键字即可，这里只介绍几个搭建时候我说遇到的问题，希望可以给大家一点帮助。</p>
<h3 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h3><p>本地生成SSH并将id_rsa.pub添加到github后，连接服务器却报：</p>
<p>Agent admitted failure to sign using the key</p>
<p>错误。出现这种情况可能所由于本地未刷新，执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh-add</div></pre></td></tr></table></figure>
<p>即可。</p>
<h3 id="安装node-js"><a href="#安装node-js" class="headerlink" title="安装node.js"></a>安装node.js</h3><p>由于网络的原因，网上给出的很对node.js资源连接不上，这里给出一个下载相对比较快的资源，依次执行命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo add-apt-repository ppa:chris-lea/node.js</div><div class="line">$ sudo apt-get update</div><div class="line">$ sudo apt-get install nodejs</div></pre></td></tr></table></figure></p>
<h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><p>安装hexo以官方介绍为准，部分博客给出的命令可能是因为hexo版本不同的问题产生异常的错误</p>
<h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-cli -g</div></pre></td></tr></table></figure>
<h4 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h4><h5 id="Setup-your-blog"><a href="#Setup-your-blog" class="headerlink" title="Setup your blog"></a>Setup your blog</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ hexo init blog</div><div class="line">$ cd blog</div></pre></td></tr></table></figure>
<h5 id="Start-the-server"><a href="#Start-the-server" class="headerlink" title="Start the server"></a>Start the server</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<h5 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new &quot;Hello Hexo&quot;</div></pre></td></tr></table></figure>
<h5 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p><a href="https://github.com/hexojs/hexo" target="_blank" rel="external">More info</a></p>
<h3 id="hexo-deploy报错"><a href="#hexo-deploy报错" class="headerlink" title="hexo deploy报错"></a>hexo deploy报错</h3><p>hexo 更新到3.0之后，deploy的type 的github需要改成git，并在deploy前执行命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-deployer-git --save</div></pre></td></tr></table></figure></p>
<h3 id="hexo-server-端口被占用"><a href="#hexo-server-端口被占用" class="headerlink" title="hexo server 端口被占用"></a>hexo server 端口被占用</h3><p>执行更换端口的命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo s -p 5000 (-p 后接端口）</div></pre></td></tr></table></figure></p>
<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><p>如果是初次搭建，一路上会有很多坑，希望你能坚持下来，完成你的个人博客搭建，开启你的博客之旅！</p>
]]></content>
    </entry>
    
  
  
</search>
